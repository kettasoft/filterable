import{_ as c,c as l,a as i,b as s,d as p,e as t,f as a,r as o,o as u}from"./app-DaF3DxPR.js";const r={},d={class:"hint-container tip"};function k(v,n){const e=o("RouteLink");return u(),l("div",null,[n[5]||(n[5]=i(`<h1 id="cache-scoping" tabindex="-1"><a class="header-anchor" href="#cache-scoping"><span>Cache Scoping</span></a></h1><div class="hint-container tip"><p class="hint-container-title">What is Cache Scoping?</p><p>Cache scoping allows you to segment your cache by different contexts (users, tenants, organizations, etc.) to ensure that cached data is properly isolated and invalidated.</p></div><h2 id="overview" tabindex="-1"><a class="header-anchor" href="#overview"><span>Overview</span></a></h2><p>Without scoping, cached results might be shared across different users or tenants, leading to data leaks or incorrect results. Cache scoping solves this by adding contextual information to cache keys.</p><h3 id="benefits" tabindex="-1"><a class="header-anchor" href="#benefits"><span>Benefits</span></a></h3><ul><li><strong>Data Isolation</strong>: Keep user and tenant data separate</li><li><strong>Precise Invalidation</strong>: Clear cache for specific users/tenants only</li><li><strong>Multi-tenancy Support</strong>: Essential for SaaS applications</li><li><strong>Security</strong>: Prevent data leaks between contexts</li></ul><h2 id="user-scoping" tabindex="-1"><a class="header-anchor" href="#user-scoping"><span>User Scoping</span></a></h2><h3 id="basic-user-scoping" tabindex="-1"><a class="header-anchor" href="#basic-user-scoping"><span>Basic User Scoping</span></a></h3><p>Automatically scope cache by the authenticated user:</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\\</span>Models<span class="token punctuation">\\</span>Post</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Automatic user scoping</span></span>
<span class="line"><span class="token variable">$posts</span> <span class="token operator">=</span> <span class="token class-name static-context">Post</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">scopeByUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// Uses auth()-&gt;id()</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Each user gets their own cached result</span></span>
<span class="line"><span class="token comment">// Cache keys:</span></span>
<span class="line"><span class="token comment">// - filterable:post_filter:user:1:...</span></span>
<span class="line"><span class="token comment">// - filterable:post_filter:user:2:...</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="explicit-user-id" tabindex="-1"><a class="header-anchor" href="#explicit-user-id"><span>Explicit User ID</span></a></h3><p>Specify a user ID explicitly:</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token comment">// Scope by specific user</span></span>
<span class="line"><span class="token variable">$posts</span> <span class="token operator">=</span> <span class="token class-name static-context">Post</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">scopeByUser</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="use-cases" tabindex="-1"><a class="header-anchor" href="#use-cases"><span>Use Cases</span></a></h3><p><strong>Personalized Feeds</strong></p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">FeedController</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// Each user sees their own cached feed</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token class-name static-context">Post</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token number">1800</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">scopeByUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;feed_type&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;personalized&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>User Dashboards</strong></p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">DashboardController</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token variable">$stats</span> <span class="token operator">=</span> <span class="token class-name static-context">DashboardStats</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token number">600</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">scopeByUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;dashboard&#39;</span><span class="token punctuation">,</span> <span class="token function">compact</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;stats&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>User Preferences</strong></p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token comment">// Cache user-specific filtered results</span></span>
<span class="line"><span class="token variable">$products</span> <span class="token operator">=</span> <span class="token class-name static-context">Product</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">scopeByUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">[</span></span>
<span class="line">        <span class="token string single-quoted-string">&#39;category&#39;</span> <span class="token operator">=&gt;</span> <span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token property">favorite_category</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string single-quoted-string">&#39;price_range&#39;</span> <span class="token operator">=&gt;</span> <span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token property">price_preference</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="tenant-scoping" tabindex="-1"><a class="header-anchor" href="#tenant-scoping"><span>Tenant Scoping</span></a></h2><h3 id="basic-tenant-scoping" tabindex="-1"><a class="header-anchor" href="#basic-tenant-scoping"><span>Basic Tenant Scoping</span></a></h3><p>Essential for multi-tenant applications:</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\\</span>Models<span class="token punctuation">\\</span>Product</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Scope by current tenant</span></span>
<span class="line"><span class="token variable">$products</span> <span class="token operator">=</span> <span class="token class-name static-context">Product</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">scopeByTenant</span><span class="token punctuation">(</span><span class="token function">tenant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Cache keys:</span></span>
<span class="line"><span class="token comment">// - filterable:product_filter:tenant:acme:...</span></span>
<span class="line"><span class="token comment">// - filterable:product_filter:tenant:globex:...</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="integration-with-tenant-packages" tabindex="-1"><a class="header-anchor" href="#integration-with-tenant-packages"><span>Integration with Tenant Packages</span></a></h3><h4 id="stancl-tenancy" tabindex="-1"><a class="header-anchor" href="#stancl-tenancy"><span>Stancl/Tenancy</span></a></h4><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token keyword">use</span> <span class="token package">Stancl<span class="token punctuation">\\</span>Tenancy<span class="token punctuation">\\</span>Facades<span class="token punctuation">\\</span>Tenancy</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token variable">$orders</span> <span class="token operator">=</span> <span class="token class-name static-context">Order</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">scopeByTenant</span><span class="token punctuation">(</span><span class="token function">tenant</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;id&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;status&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;pending&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="spatie-multi-tenancy" tabindex="-1"><a class="header-anchor" href="#spatie-multi-tenancy"><span>Spatie Multi-Tenancy</span></a></h4><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token keyword">use</span> <span class="token package">Spatie<span class="token punctuation">\\</span>Multitenancy<span class="token punctuation">\\</span>Models<span class="token punctuation">\\</span>Tenant</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token variable">$data</span> <span class="token operator">=</span> <span class="token class-name static-context">Model</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">scopeByTenant</span><span class="token punctuation">(</span><span class="token class-name static-context">Tenant</span><span class="token operator">::</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="use-cases-1" tabindex="-1"><a class="header-anchor" href="#use-cases-1"><span>Use Cases</span></a></h3><p><strong>Tenant Dashboards</strong></p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">TenantDashboardController</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token variable">$metrics</span> <span class="token operator">=</span> <span class="token class-name static-context">Metric</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token number">600</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">scopeByTenant</span><span class="token punctuation">(</span><span class="token function">tenant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;tenant.dashboard&#39;</span><span class="token punctuation">,</span> <span class="token function">compact</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;metrics&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Tenant Reports</strong></p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token comment">// Each tenant has their own cached reports</span></span>
<span class="line"><span class="token variable">$report</span> <span class="token operator">=</span> <span class="token class-name static-context">SalesReport</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token number">7200</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">scopeByTenant</span><span class="token punctuation">(</span><span class="token function">tenant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;year&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">2024</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Tenant Settings</strong></p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token comment">// Cache tenant-specific configuration</span></span>
<span class="line"><span class="token variable">$settings</span> <span class="token operator">=</span> <span class="token class-name static-context">Setting</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">cacheForever</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">scopeByTenant</span><span class="token punctuation">(</span><span class="token function">tenant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="custom-scoping" tabindex="-1"><a class="header-anchor" href="#custom-scoping"><span>Custom Scoping</span></a></h2><h3 id="single-custom-scope" tabindex="-1"><a class="header-anchor" href="#single-custom-scope"><span>Single Custom Scope</span></a></h3><p>Add any custom scope to your cache:</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\\</span>Models<span class="token punctuation">\\</span>Document</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Scope by organization</span></span>
<span class="line"><span class="token variable">$documents</span> <span class="token operator">=</span> <span class="token class-name static-context">Document</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">scopeBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;organization&#39;</span><span class="token punctuation">,</span> <span class="token variable">$organizationId</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Scope by department</span></span>
<span class="line"><span class="token variable">$reports</span> <span class="token operator">=</span> <span class="token class-name static-context">Report</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">scopeBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;department&#39;</span><span class="token punctuation">,</span> <span class="token variable">$departmentId</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="multiple-custom-scopes" tabindex="-1"><a class="header-anchor" href="#multiple-custom-scopes"><span>Multiple Custom Scopes</span></a></h3><p>Chain multiple scopes for fine-grained control:</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token comment">// Scope by organization and department</span></span>
<span class="line"><span class="token variable">$data</span> <span class="token operator">=</span> <span class="token class-name static-context">Model</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">scopeBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;organization&#39;</span><span class="token punctuation">,</span> <span class="token variable">$orgId</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">scopeBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;department&#39;</span><span class="token punctuation">,</span> <span class="token variable">$deptId</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">scopeBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;region&#39;</span><span class="token punctuation">,</span> <span class="token variable">$region</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Cache key includes all scopes:</span></span>
<span class="line"><span class="token comment">// filterable:model_filter:organization:123:department:456:region:west:...</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="batch-scopes" tabindex="-1"><a class="header-anchor" href="#batch-scopes"><span>Batch Scopes</span></a></h3><p>Set multiple scopes at once:</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token variable">$filters</span> <span class="token operator">=</span> <span class="token class-name static-context">Request</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">withScopes</span><span class="token punctuation">(</span><span class="token punctuation">[</span></span>
<span class="line">        <span class="token string single-quoted-string">&#39;organization&#39;</span> <span class="token operator">=&gt;</span> <span class="token variable">$orgId</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string single-quoted-string">&#39;department&#39;</span> <span class="token operator">=&gt;</span> <span class="token variable">$deptId</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string single-quoted-string">&#39;region&#39;</span> <span class="token operator">=&gt;</span> <span class="token variable">$region</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string single-quoted-string">&#39;team&#39;</span> <span class="token operator">=&gt;</span> <span class="token variable">$teamId</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="use-cases-2" tabindex="-1"><a class="header-anchor" href="#use-cases-2"><span>Use Cases</span></a></h3><p><strong>Multi-Level Organizations</strong></p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">OrganizationController</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">departmentData</span><span class="token punctuation">(</span><span class="token variable">$orgId</span><span class="token punctuation">,</span> <span class="token variable">$deptId</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token class-name static-context">Data</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token number">1800</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">scopeBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;organization&#39;</span><span class="token punctuation">,</span> <span class="token variable">$orgId</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">scopeBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;department&#39;</span><span class="token punctuation">,</span> <span class="token variable">$deptId</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Geographic Segmentation</strong></p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token comment">// Different cache for each region</span></span>
<span class="line"><span class="token variable">$products</span> <span class="token operator">=</span> <span class="token class-name static-context">Product</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">scopeBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;country&#39;</span><span class="token punctuation">,</span> <span class="token variable">$country</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">scopeBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;region&#39;</span><span class="token punctuation">,</span> <span class="token variable">$region</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;status&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;active&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Temporal Scoping</strong></p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token comment">// Different cache for different time periods</span></span>
<span class="line"><span class="token variable">$analytics</span> <span class="token operator">=</span> <span class="token class-name static-context">Analytics</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">scopeBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;period&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;monthly&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">scopeBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;year&#39;</span><span class="token punctuation">,</span> <span class="token number">2024</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">scopeBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;month&#39;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="combined-scoping" tabindex="-1"><a class="header-anchor" href="#combined-scoping"><span>Combined Scoping</span></a></h2><h3 id="user-tenant" tabindex="-1"><a class="header-anchor" href="#user-tenant"><span>User + Tenant</span></a></h3><p>Perfect for SaaS applications where users belong to tenants:</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token comment">// Scope by both tenant and user</span></span>
<span class="line"><span class="token variable">$personalData</span> <span class="token operator">=</span> <span class="token class-name static-context">UserData</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token number">1800</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">scopeByTenant</span><span class="token punctuation">(</span><span class="token function">tenant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">scopeByUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Cache key:</span></span>
<span class="line"><span class="token comment">// filterable:user_data_filter:tenant:acme:user:123:...</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="user-custom-scopes" tabindex="-1"><a class="header-anchor" href="#user-custom-scopes"><span>User + Custom Scopes</span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token comment">// User-specific data within an organization</span></span>
<span class="line"><span class="token variable">$projects</span> <span class="token operator">=</span> <span class="token class-name static-context">Project</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">scopeByUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">scopeBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;organization&#39;</span><span class="token punctuation">,</span> <span class="token variable">$orgId</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">scopeBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;team&#39;</span><span class="token punctuation">,</span> <span class="token variable">$teamId</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="multiple-context-layers" tabindex="-1"><a class="header-anchor" href="#multiple-context-layers"><span>Multiple Context Layers</span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">MultiContextFilter</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getData</span><span class="token punctuation">(</span><span class="token variable">$userId</span><span class="token punctuation">,</span> <span class="token variable">$tenantId</span><span class="token punctuation">,</span> <span class="token variable">$orgId</span><span class="token punctuation">,</span> <span class="token variable">$role</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token class-name static-context">Model</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">scopeByUser</span><span class="token punctuation">(</span><span class="token variable">$userId</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">scopeByTenant</span><span class="token punctuation">(</span><span class="token variable">$tenantId</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">scopeBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;organization&#39;</span><span class="token punctuation">,</span> <span class="token variable">$orgId</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">scopeBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;role&#39;</span><span class="token punctuation">,</span> <span class="token variable">$role</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="scope-patterns" tabindex="-1"><a class="header-anchor" href="#scope-patterns"><span>Scope Patterns</span></a></h2><h3 id="middleware-based-scoping" tabindex="-1"><a class="header-anchor" href="#middleware-based-scoping"><span>Middleware-based Scoping</span></a></h3><p>Automatically apply scopes via middleware:</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token comment">// app/Http/Middleware/ApplyCacheScopes.php</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">ApplyCacheScopes</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">handle</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> <span class="token class-name type-declaration">Closure</span> <span class="token variable">$next</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// Store scopes in a service</span></span>
<span class="line">        <span class="token function">app</span><span class="token punctuation">(</span><span class="token class-name static-context">FilterableCacheManager</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">addScope</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;tenant&#39;</span><span class="token punctuation">,</span> <span class="token function">tenant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">addScope</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;user&#39;</span><span class="token punctuation">,</span> <span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$next</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token comment">// Use in routes</span></span>
<span class="line"><span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">middleware</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;auth&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;tenant&#39;</span><span class="token punctuation">,</span> <span class="token class-name static-context">ApplyCacheScopes</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// All filterable queries here will be scoped automatically</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="base-filter-with-default-scoping" tabindex="-1"><a class="header-anchor" href="#base-filter-with-default-scoping"><span>Base Filter with Default Scoping</span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">TenantScopedFilter</span> <span class="token keyword">extends</span> <span class="token class-name">Filterable</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">use</span> <span class="token package">HasFilterableCache</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">applyCache</span><span class="token punctuation">(</span><span class="token keyword type-hint">int</span> <span class="token variable">$ttl</span> <span class="token operator">=</span> <span class="token number">3600</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token variable">$ttl</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">scopeByTenant</span><span class="token punctuation">(</span><span class="token function">tenant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token comment">// Usage</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">ProductFilter</span> <span class="token keyword">extends</span> <span class="token class-name">TenantScopedFilter</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">apply</span><span class="token punctuation">(</span><span class="token keyword type-hint">array</span> <span class="token variable">$filters</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Builder</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword static-context">parent</span><span class="token operator">::</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token variable">$filters</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">applyCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Automatically tenant-scoped</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="service-provider-integration" tabindex="-1"><a class="header-anchor" href="#service-provider-integration"><span>Service Provider Integration</span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token comment">// app/Providers/FilterableCacheServiceProvider.php</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">FilterableCacheServiceProvider</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceProvider</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// Auto-apply tenant scope to all filterable caches</span></span>
<span class="line">        <span class="token class-name static-context">Filterable</span><span class="token operator">::</span><span class="token function">resolving</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$filter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">tenant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token variable">$filter</span><span class="token operator">-&gt;</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token punctuation">)</span></span>
<span class="line">                    <span class="token operator">-&gt;</span><span class="token function">scopeByTenant</span><span class="token punctuation">(</span><span class="token function">tenant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">)</span></span>
<span class="line">                    <span class="token operator">-&gt;</span><span class="token function">scopeByUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="cache-invalidation-with-scopes" tabindex="-1"><a class="header-anchor" href="#cache-invalidation-with-scopes"><span>Cache Invalidation with Scopes</span></a></h2><h3 id="flush-user-specific-cache" tabindex="-1"><a class="header-anchor" href="#flush-user-specific-cache"><span>Flush User-specific Cache</span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token keyword">use</span> <span class="token package">Kettasoft<span class="token punctuation">\\</span>Filterable<span class="token punctuation">\\</span>Caching<span class="token punctuation">\\</span>FilterableCacheManager</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Clear all cache for a specific user</span></span>
<span class="line"><span class="token variable">$manager</span> <span class="token operator">=</span> <span class="token class-name static-context">FilterableCacheManager</span><span class="token operator">::</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token variable">$manager</span><span class="token operator">-&gt;</span><span class="token function">addScope</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;user&#39;</span><span class="token punctuation">,</span> <span class="token variable">$userId</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">flushByTags</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;posts&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="flush-tenant-specific-cache" tabindex="-1"><a class="header-anchor" href="#flush-tenant-specific-cache"><span>Flush Tenant-specific Cache</span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token comment">// Clear all cache for a tenant</span></span>
<span class="line"><span class="token variable">$manager</span> <span class="token operator">=</span> <span class="token class-name static-context">FilterableCacheManager</span><span class="token operator">::</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token variable">$manager</span><span class="token operator">-&gt;</span><span class="token function">addScope</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;tenant&#39;</span><span class="token punctuation">,</span> <span class="token variable">$tenantId</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">flushByTags</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;products&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;orders&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="selective-invalidation" tabindex="-1"><a class="header-anchor" href="#selective-invalidation"><span>Selective Invalidation</span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token comment">// Clear specific scope combinations</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function-definition function">clearUserTenantCache</span><span class="token punctuation">(</span><span class="token variable">$userId</span><span class="token punctuation">,</span> <span class="token variable">$tenantId</span><span class="token punctuation">,</span> <span class="token keyword type-hint">array</span> <span class="token variable">$tags</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token variable">$manager</span> <span class="token operator">=</span> <span class="token class-name static-context">FilterableCacheManager</span><span class="token operator">::</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token variable">$manager</span><span class="token operator">-&gt;</span><span class="token function">addScope</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;user&#39;</span><span class="token punctuation">,</span> <span class="token variable">$userId</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token operator">-&gt;</span><span class="token function">addScope</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;tenant&#39;</span><span class="token punctuation">,</span> <span class="token variable">$tenantId</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token operator">-&gt;</span><span class="token function">flushByTags</span><span class="token punctuation">(</span><span class="token variable">$tags</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token function">clearUserTenantCache</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;acme&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;dashboard&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;reports&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="real-world-examples" tabindex="-1"><a class="header-anchor" href="#real-world-examples"><span>Real-world Examples</span></a></h2><h3 id="saas-platform" tabindex="-1"><a class="header-anchor" href="#saas-platform"><span>SaaS Platform</span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token comment">// Multi-level scoping for SaaS</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">SaaSDataController</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">tenantUserData</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token class-name static-context">Data</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token number">1800</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">scopeByTenant</span><span class="token punctuation">(</span><span class="token function">tenant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">scopeByUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">scopeBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;subscription_tier&#39;</span><span class="token punctuation">,</span> <span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token property">tier</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">organizationData</span><span class="token punctuation">(</span><span class="token variable">$orgId</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token class-name static-context">OrganizationData</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">scopeByTenant</span><span class="token punctuation">(</span><span class="token function">tenant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">scopeBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;organization&#39;</span><span class="token punctuation">,</span> <span class="token variable">$orgId</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="multi-organization-platform" tabindex="-1"><a class="header-anchor" href="#multi-organization-platform"><span>Multi-Organization Platform</span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token comment">// User can belong to multiple organizations</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">OrganizationDataController</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">index</span><span class="token punctuation">(</span><span class="token variable">$organizationId</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// Scope by current organization</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token class-name static-context">Model</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">scopeBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;organization&#39;</span><span class="token punctuation">,</span> <span class="token variable">$organizationId</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">scopeByUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// User-specific within org</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="regional-e-commerce" tabindex="-1"><a class="header-anchor" href="#regional-e-commerce"><span>Regional E-commerce</span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token comment">// Different pricing/products per region</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">ProductController</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">catalog</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token variable">$region</span> <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;X-Region&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;US&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token variable">$currency</span> <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;X-Currency&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;USD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token class-name static-context">Product</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">scopeBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;region&#39;</span><span class="token punctuation">,</span> <span class="token variable">$region</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">scopeBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;currency&#39;</span><span class="token punctuation">,</span> <span class="token variable">$currency</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">scopeBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;language&#39;</span><span class="token punctuation">,</span> <span class="token function">app</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getLocale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;status&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;active&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="advanced-patterns" tabindex="-1"><a class="header-anchor" href="#advanced-patterns"><span>Advanced Patterns</span></a></h2><h3 id="dynamic-scope-resolution" tabindex="-1"><a class="header-anchor" href="#dynamic-scope-resolution"><span>Dynamic Scope Resolution</span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">SmartScopeFilter</span> <span class="token keyword">extends</span> <span class="token class-name">Filterable</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">resolveScopes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">array</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token variable">$scopes</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token variable">$scopes</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;user&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">tenant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token variable">$scopes</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;tenant&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">tenant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;organization&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token variable">$scopes</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;organization&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">session</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;organization&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$scopes</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">apply</span><span class="token punctuation">(</span><span class="token keyword type-hint">array</span> <span class="token variable">$filters</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Builder</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token variable">$query</span> <span class="token operator">=</span> <span class="token keyword static-context">parent</span><span class="token operator">::</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token variable">$filters</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">resolveScopes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=&gt;</span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token variable">$query</span><span class="token operator">-&gt;</span><span class="token function">scopeBy</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$query</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="scope-inheritance" tabindex="-1"><a class="header-anchor" href="#scope-inheritance"><span>Scope Inheritance</span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token comment">// Base filter with default scopes</span></span>
<span class="line"><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">ScopedFilter</span> <span class="token keyword">extends</span> <span class="token class-name">Filterable</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">protected</span> <span class="token keyword type-declaration">array</span> <span class="token variable">$defaultScopes</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">getScopes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">array</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">defaultScopes</span><span class="token punctuation">,</span> <span class="token punctuation">[</span></span>
<span class="line">            <span class="token string single-quoted-string">&#39;environment&#39;</span> <span class="token operator">=&gt;</span> <span class="token function">app</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">environment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">applyScopedCache</span><span class="token punctuation">(</span><span class="token keyword type-hint">int</span> <span class="token variable">$ttl</span> <span class="token operator">=</span> <span class="token number">3600</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token variable">$cache</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token variable">$ttl</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">getScopes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=&gt;</span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token variable">$cache</span><span class="token operator">-&gt;</span><span class="token function">scopeBy</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token variable">$cache</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token comment">// Specific filter inheriting scope behavior</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">ProductFilter</span> <span class="token keyword">extends</span> <span class="token class-name">ScopedFilter</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">protected</span> <span class="token keyword type-declaration">array</span> <span class="token variable">$defaultScopes</span> <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token string single-quoted-string">&#39;category&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;default&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="best-practices" tabindex="-1"><a class="header-anchor" href="#best-practices"><span>Best Practices</span></a></h2><h3 id="_1-always-scope-multi-tenant-data" tabindex="-1"><a class="header-anchor" href="#_1-always-scope-multi-tenant-data"><span>1. Always Scope Multi-tenant Data</span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token comment">//  Bad - Shared cache across tenants</span></span>
<span class="line"><span class="token variable">$data</span> <span class="token operator">=</span> <span class="token class-name static-context">Model</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//  Good - Tenant-isolated cache</span></span>
<span class="line"><span class="token variable">$data</span> <span class="token operator">=</span> <span class="token class-name static-context">Model</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">scopeByTenant</span><span class="token punctuation">(</span><span class="token function">tenant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-scope-sensitive-user-data" tabindex="-1"><a class="header-anchor" href="#_2-scope-sensitive-user-data"><span>2. Scope Sensitive User Data</span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token comment">//  Bad - User A might see User B&#39;s cached data</span></span>
<span class="line"><span class="token variable">$personalData</span> <span class="token operator">=</span> <span class="token class-name static-context">UserData</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token number">1800</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//  Good - Each user has separate cache</span></span>
<span class="line"><span class="token variable">$personalData</span> <span class="token operator">=</span> <span class="token class-name static-context">UserData</span><span class="token operator">::</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token number">1800</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">scopeByUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-use-consistent-scope-keys" tabindex="-1"><a class="header-anchor" href="#_3-use-consistent-scope-keys"><span>3. Use Consistent Scope Keys</span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token comment">//  Bad - Inconsistent naming</span></span>
<span class="line"><span class="token operator">-&gt;</span><span class="token function">scopeBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;org&#39;</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">-&gt;</span><span class="token function">scopeBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;organization&#39;</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">-&gt;</span><span class="token function">scopeBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;org_id&#39;</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//  Good - Consistent across application</span></span>
<span class="line"><span class="token operator">-&gt;</span><span class="token function">scopeBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;organization&#39;</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-document-your-scoping-strategy" tabindex="-1"><a class="header-anchor" href="#_4-document-your-scoping-strategy"><span>4. Document Your Scoping Strategy</span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * ProductFilter</span>
<span class="line"> *</span>
<span class="line"> * Cache Scoping:</span>
<span class="line"> * - tenant: Current tenant ID</span>
<span class="line"> * - region: Geographic region</span>
<span class="line"> * - currency: Currency code</span>
<span class="line"> *</span>
<span class="line"> * Example cache key:</span>
<span class="line"> * filterable:product_filter:tenant:acme:region:US:currency:USD:...</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name-definition class-name">ProductFilter</span> <span class="token keyword">extends</span> <span class="token class-name">Filterable</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// ...</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-monitor-scope-effectiveness" tabindex="-1"><a class="header-anchor" href="#_5-monitor-scope-effectiveness"><span>5. Monitor Scope Effectiveness</span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token comment">// Log scope usage for debugging</span></span>
<span class="line"><span class="token class-name static-context">Log</span><span class="token operator">::</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;Cache scope applied&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token string single-quoted-string">&#39;filter&#39;</span> <span class="token operator">=&gt;</span> <span class="token keyword static-context">static</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string single-quoted-string">&#39;scopes&#39;</span> <span class="token operator">=&gt;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">getCacheScopes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string single-quoted-string">&#39;key&#39;</span> <span class="token operator">=&gt;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">getCacheKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="troubleshooting" tabindex="-1"><a class="header-anchor" href="#troubleshooting"><span>Troubleshooting</span></a></h2><h3 id="cache-leaking-between-users" tabindex="-1"><a class="header-anchor" href="#cache-leaking-between-users"><span>Cache Leaking Between Users</span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token comment">// Problem: Users seeing each other&#39;s data</span></span>
<span class="line"><span class="token comment">// Solution: Add user scoping</span></span>
<span class="line"><span class="token operator">-&gt;</span><span class="token function">scopeByUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="cache-not-invalidating" tabindex="-1"><a class="header-anchor" href="#cache-not-invalidating"><span>Cache Not Invalidating</span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token comment">// Problem: Cache persists after tenant data changes</span></span>
<span class="line"><span class="token comment">// Solution: Ensure auto-invalidation observer includes tenant scope</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// config/filterable.php</span></span>
<span class="line"><span class="token string single-quoted-string">&#39;auto_invalidate&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token string single-quoted-string">&#39;enabled&#39;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string single-quoted-string">&#39;models&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token class-name static-context">Product</span><span class="token operator">::</span><span class="token keyword">class</span> <span class="token operator">=&gt;</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token variable">$product</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token punctuation">[</span></span>
<span class="line">                <span class="token string single-quoted-string">&#39;products&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token string double-quoted-string">&quot;tenant:<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$product</span><span class="token operator">-&gt;</span><span class="token property">tenant_id</span><span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="inconsistent-cache-keys" tabindex="-1"><a class="header-anchor" href="#inconsistent-cache-keys"><span>Inconsistent Cache Keys</span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token comment">// Problem: Same query generating different keys</span></span>
<span class="line"><span class="token comment">// Solution: Ensure scope order is consistent</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Use withScopes() for consistent ordering</span></span>
<span class="line"><span class="token operator">-&gt;</span><span class="token function">withScopes</span><span class="token punctuation">(</span><span class="token punctuation">[</span></span>
<span class="line">    <span class="token string single-quoted-string">&#39;tenant&#39;</span> <span class="token operator">=&gt;</span> <span class="token variable">$tenantId</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string single-quoted-string">&#39;user&#39;</span> <span class="token operator">=&gt;</span> <span class="token variable">$userId</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string single-quoted-string">&#39;organization&#39;</span> <span class="token operator">=&gt;</span> <span class="token variable">$orgId</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,109)),s("div",d,[n[4]||(n[4]=s("p",{class:"hint-container-title"},"Next Steps",-1)),s("ul",null,[s("li",null,[p(e,{to:"/caching/getting-started.html"},{default:t(()=>n[0]||(n[0]=[a("Getting Started ")])),_:1})]),s("li",null,[p(e,{to:"/caching/auto-invalidation.html"},{default:t(()=>n[1]||(n[1]=[a("Auto-invalidation ")])),_:1})]),s("li",null,[p(e,{to:"/caching/profiles.html"},{default:t(()=>n[2]||(n[2]=[a("Cache Profiles ")])),_:1}),n[3]||(n[3]=a(" :::"))])])])])}const g=c(r,[["render",k],["__file","scoping.html.vue"]]),b=JSON.parse('{"path":"/caching/scoping.html","title":"Cache Scoping","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"Overview","slug":"overview","link":"#overview","children":[{"level":3,"title":"Benefits","slug":"benefits","link":"#benefits","children":[]}]},{"level":2,"title":"User Scoping","slug":"user-scoping","link":"#user-scoping","children":[{"level":3,"title":"Basic User Scoping","slug":"basic-user-scoping","link":"#basic-user-scoping","children":[]},{"level":3,"title":"Explicit User ID","slug":"explicit-user-id","link":"#explicit-user-id","children":[]},{"level":3,"title":"Use Cases","slug":"use-cases","link":"#use-cases","children":[]}]},{"level":2,"title":"Tenant Scoping","slug":"tenant-scoping","link":"#tenant-scoping","children":[{"level":3,"title":"Basic Tenant Scoping","slug":"basic-tenant-scoping","link":"#basic-tenant-scoping","children":[]},{"level":3,"title":"Integration with Tenant Packages","slug":"integration-with-tenant-packages","link":"#integration-with-tenant-packages","children":[]},{"level":3,"title":"Use Cases","slug":"use-cases-1","link":"#use-cases-1","children":[]}]},{"level":2,"title":"Custom Scoping","slug":"custom-scoping","link":"#custom-scoping","children":[{"level":3,"title":"Single Custom Scope","slug":"single-custom-scope","link":"#single-custom-scope","children":[]},{"level":3,"title":"Multiple Custom Scopes","slug":"multiple-custom-scopes","link":"#multiple-custom-scopes","children":[]},{"level":3,"title":"Batch Scopes","slug":"batch-scopes","link":"#batch-scopes","children":[]},{"level":3,"title":"Use Cases","slug":"use-cases-2","link":"#use-cases-2","children":[]}]},{"level":2,"title":"Combined Scoping","slug":"combined-scoping","link":"#combined-scoping","children":[{"level":3,"title":"User + Tenant","slug":"user-tenant","link":"#user-tenant","children":[]},{"level":3,"title":"User + Custom Scopes","slug":"user-custom-scopes","link":"#user-custom-scopes","children":[]},{"level":3,"title":"Multiple Context Layers","slug":"multiple-context-layers","link":"#multiple-context-layers","children":[]}]},{"level":2,"title":"Scope Patterns","slug":"scope-patterns","link":"#scope-patterns","children":[{"level":3,"title":"Middleware-based Scoping","slug":"middleware-based-scoping","link":"#middleware-based-scoping","children":[]},{"level":3,"title":"Base Filter with Default Scoping","slug":"base-filter-with-default-scoping","link":"#base-filter-with-default-scoping","children":[]},{"level":3,"title":"Service Provider Integration","slug":"service-provider-integration","link":"#service-provider-integration","children":[]}]},{"level":2,"title":"Cache Invalidation with Scopes","slug":"cache-invalidation-with-scopes","link":"#cache-invalidation-with-scopes","children":[{"level":3,"title":"Flush User-specific Cache","slug":"flush-user-specific-cache","link":"#flush-user-specific-cache","children":[]},{"level":3,"title":"Flush Tenant-specific Cache","slug":"flush-tenant-specific-cache","link":"#flush-tenant-specific-cache","children":[]},{"level":3,"title":"Selective Invalidation","slug":"selective-invalidation","link":"#selective-invalidation","children":[]}]},{"level":2,"title":"Real-world Examples","slug":"real-world-examples","link":"#real-world-examples","children":[{"level":3,"title":"SaaS Platform","slug":"saas-platform","link":"#saas-platform","children":[]},{"level":3,"title":"Multi-Organization Platform","slug":"multi-organization-platform","link":"#multi-organization-platform","children":[]},{"level":3,"title":"Regional E-commerce","slug":"regional-e-commerce","link":"#regional-e-commerce","children":[]}]},{"level":2,"title":"Advanced Patterns","slug":"advanced-patterns","link":"#advanced-patterns","children":[{"level":3,"title":"Dynamic Scope Resolution","slug":"dynamic-scope-resolution","link":"#dynamic-scope-resolution","children":[]},{"level":3,"title":"Scope Inheritance","slug":"scope-inheritance","link":"#scope-inheritance","children":[]}]},{"level":2,"title":"Best Practices","slug":"best-practices","link":"#best-practices","children":[{"level":3,"title":"1. Always Scope Multi-tenant Data","slug":"_1-always-scope-multi-tenant-data","link":"#_1-always-scope-multi-tenant-data","children":[]},{"level":3,"title":"2. Scope Sensitive User Data","slug":"_2-scope-sensitive-user-data","link":"#_2-scope-sensitive-user-data","children":[]},{"level":3,"title":"3. Use Consistent Scope Keys","slug":"_3-use-consistent-scope-keys","link":"#_3-use-consistent-scope-keys","children":[]},{"level":3,"title":"4. Document Your Scoping Strategy","slug":"_4-document-your-scoping-strategy","link":"#_4-document-your-scoping-strategy","children":[]},{"level":3,"title":"5. Monitor Scope Effectiveness","slug":"_5-monitor-scope-effectiveness","link":"#_5-monitor-scope-effectiveness","children":[]}]},{"level":2,"title":"Troubleshooting","slug":"troubleshooting","link":"#troubleshooting","children":[{"level":3,"title":"Cache Leaking Between Users","slug":"cache-leaking-between-users","link":"#cache-leaking-between-users","children":[]},{"level":3,"title":"Cache Not Invalidating","slug":"cache-not-invalidating","link":"#cache-not-invalidating","children":[]},{"level":3,"title":"Inconsistent Cache Keys","slug":"inconsistent-cache-keys","link":"#inconsistent-cache-keys","children":[]}]}],"git":{"updatedTime":1762955423000,"contributors":[{"name":"kettasoft","email":"kettasoft@gmail.com","commits":2}]},"filePathRelative":"caching/scoping.md"}');export{g as comp,b as data};
