import{_ as n,c as s,a,o as t}from"./app-Cj092IKu.js";const i={};function l(r,e){return t(),s("div",null,e[0]||(e[0]=[a(`<h1 id="header-driven-filter-mode" tabindex="-1"><a class="header-anchor" href="#header-driven-filter-mode"><span>Header-Driven Filter Mode</span></a></h1><h2 id="overview" tabindex="-1"><a class="header-anchor" href="#overview"><span>Overview</span></a></h2><p>Dynamically select filter engines per request using HTTP headers. This enables:</p><ul><li>Different filtering strategies for various clients (mobile/web)</li><li>A/B testing of filter engines</li><li>Gradual migration between engines</li></ul><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token comment">// Example: Force using Tree engine</span></span>
<span class="line">curl <span class="token operator">-</span><span class="token constant">H</span> <span class="token string double-quoted-string">&quot;X-Filter-Mode: tree&quot;</span> https<span class="token punctuation">:</span><span class="token comment">//api.example.com/products</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="configuration" tabindex="-1"><a class="header-anchor" href="#configuration"><span>Configuration</span></a></h2><h3 id="enable-feature" tabindex="-1"><a class="header-anchor" href="#enable-feature"><span>Enable Feature</span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token string single-quoted-string">&#39;header_driven_mode&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span></span>
<span class="line">  <span class="token string single-quoted-string">&#39;enabled&#39;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// Enable/disable entire feature</span></span>
<span class="line">  <span class="token string single-quoted-string">&#39;header_name&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;X-Filter-Mode&#39;</span><span class="token punctuation">,</span> <span class="token comment">// Customize header name</span></span>
<span class="line">  <span class="token string single-quoted-string">&#39;fallback_strategy&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;default&#39;</span> <span class="token comment">// &#39;default&#39; or &#39;error&#39;</span></span>
<span class="line"><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="engine-whitelisting" tabindex="-1"><a class="header-anchor" href="#engine-whitelisting"><span>Engine Whitelisting</span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token string single-quoted-string">&#39;allowed_engines&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;dynamic&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;tree&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// Empty array allows all</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="name-aliasing" tabindex="-1"><a class="header-anchor" href="#name-aliasing"><span>Name Aliasing</span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token string single-quoted-string">&#39;engine_map&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span></span>
<span class="line">  <span class="token string single-quoted-string">&#39;simple&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;ruleset&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string single-quoted-string">&#39;advanced&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;dynamic&#39;</span></span>
<span class="line"><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token comment">// Use: -H &quot;X-Filter-Mode: simple&quot; =&gt; ruleset</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="usage-guide" tabindex="-1"><a class="header-anchor" href="#usage-guide"><span>Usage Guide</span></a></h2><h3 id="basic-implementation" tabindex="-1"><a class="header-anchor" href="#basic-implementation"><span>Basic Implementation</span></a></h3><ol><li>Add header to request:</li></ol><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token constant">GET</span> <span class="token operator">/</span>api<span class="token operator">/</span>users <span class="token constant">X</span><span class="token operator">-</span>Filter<span class="token operator">-</span>Mode<span class="token punctuation">:</span> tree</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol><li>Server will: <ul><li>Validate header value</li><li>Map aliases if configured</li><li>Apply specified engine</li></ul></li></ol><hr><h3 id="error-handling" tabindex="-1"><a class="header-anchor" href="#error-handling"><span>Error Handling</span></a></h3><p>When <code>fallback_strategy = &#39;error&#39;</code>:</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;error&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Invalid filter engine&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;allowed&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;dynamic&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tree&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;aliases&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;simple&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ruleset&quot;</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="per-query-selection" tabindex="-1"><a class="header-anchor" href="#per-query-selection"><span>Per-Query Selection</span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token class-name static-context">Filterable</span><span class="token operator">::</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token class-name static-context">Product</span><span class="token operator">::</span><span class="token constant">query</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">withHeaderDrivenMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="method-reference" tabindex="-1"><a class="header-anchor" href="#method-reference"><span>Method Reference</span></a></h4><p>withHeaderDrivenMode(array $config)</p><table><thead><tr><th>Option</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>header_name</td><td>string</td><td>config value</td><td>The HTTP header name that will be checked for engine selection.</td></tr><tr><td>allowed_engines</td><td>array</td><td>config value</td><td>List of engine names that can be specified in the header.</td></tr><tr><td>engine_map</td><td>array</td><td>config value</td><td>Maps header values to actual engine names.</td></tr><tr><td>fallback_strategy</td><td>string</td><td>config value</td><td>Determines behavior when an invalid engine is specified</td></tr></tbody></table><h2 id="best-practices" tabindex="-1"><a class="header-anchor" href="#best-practices"><span>Best Practices</span></a></h2><ol><li><strong>Security</strong>: Always whitelist engines in production</li></ol><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token string single-quoted-string">&#39;allowed_engines&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;dynamic&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;tree&#39;</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="important-notes" tabindex="-1"><a class="header-anchor" href="#important-notes"><span>Important Notes</span></a></h2><h3 id="closure-engine-limitation" tabindex="-1"><a class="header-anchor" href="#closure-engine-limitation"><span>Closure Engine Limitation</span></a></h3><div class="hint-container warning"><p class="hint-container-title">Warning</p><p>Header-driven mode <strong>cannot</strong> be used with <a href="engines/closure"><strong>Closure Pipeline Engine</strong></a> because:</p><ul><li>Closures cannot be serialized in headers</li><li>Runtime pipeline modifications require code-level changes</li></ul></div><h4 id="security-considerations" tabindex="-1"><a class="header-anchor" href="#security-considerations"><span>Security Considerations</span></a></h4><ul><li>Always whitelist allowed engines in production</li><li>Consider rate limiting header modifications</li><li>Disable in stateless environments where headers can&#39;t be trusted</li></ul>`,35)]))}const o=n(i,[["render",l],["__file","header-driven-filter-mode.html.vue"]]),c=JSON.parse('{"path":"/features/header-driven-filter-mode.html","title":"Header-Driven Filter Mode","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"Overview","slug":"overview","link":"#overview","children":[]},{"level":2,"title":"Configuration","slug":"configuration","link":"#configuration","children":[{"level":3,"title":"Enable Feature","slug":"enable-feature","link":"#enable-feature","children":[]},{"level":3,"title":"Engine Whitelisting","slug":"engine-whitelisting","link":"#engine-whitelisting","children":[]},{"level":3,"title":"Name Aliasing","slug":"name-aliasing","link":"#name-aliasing","children":[]}]},{"level":2,"title":"Usage Guide","slug":"usage-guide","link":"#usage-guide","children":[{"level":3,"title":"Basic Implementation","slug":"basic-implementation","link":"#basic-implementation","children":[]},{"level":3,"title":"Error Handling","slug":"error-handling","link":"#error-handling","children":[]},{"level":3,"title":"Per-Query Selection","slug":"per-query-selection","link":"#per-query-selection","children":[]}]},{"level":2,"title":"Best Practices","slug":"best-practices","link":"#best-practices","children":[]},{"level":2,"title":"Important Notes","slug":"important-notes","link":"#important-notes","children":[{"level":3,"title":"Closure Engine Limitation","slug":"closure-engine-limitation","link":"#closure-engine-limitation","children":[]}]}],"git":{"updatedTime":1747728168000,"contributors":[{"name":"Abdalrhman Emad Saad","email":"a.emad@codeclouders.com","commits":1}]},"filePathRelative":"features/header-driven-filter-mode.md"}');export{o as comp,c as data};
